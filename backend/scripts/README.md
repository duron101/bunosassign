# NeDBæµ‹è¯•æ•°æ®å’ŒéªŒè¯è„šæœ¬

è¿™ä¸ªç›®å½•åŒ…å«äº†ç”¨äºNeDBæ•°æ®åº“æµ‹è¯•æ•°æ®åˆ›å»ºå’ŒéªŒè¯çš„å®Œæ•´è„šæœ¬å¥—ä»¶ã€‚æ‰€æœ‰è„šæœ¬éƒ½è®¾è®¡ä¸ºåœ¨ `localhost:3002` ç¯å¢ƒä¸‹è¿è¡Œï¼Œç›´æ¥æ“ä½œNeDBæ–‡ä»¶ã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### 1. NeDBæ•°æ®æŸ¥çœ‹è„šæœ¬
**æ–‡ä»¶**: `check-nedb-data.js`
**åŠŸèƒ½**: 
- è¯»å–å¹¶æ˜¾ç¤ºæ‰€æœ‰NeDBæ•°æ®åº“æ–‡ä»¶å†…å®¹
- åˆ†ææ•°æ®ç»“æ„å’Œå…³è”å…³ç³»
- æ£€æŸ¥test2ç”¨æˆ·çš„è¯¦ç»†é…ç½®
- ç»Ÿè®¡é¡¹ç›®çŠ¶æ€åˆ†å¸ƒ

```bash
node scripts/check-nedb-data.js
```

### 2. æµ‹è¯•æ•°æ®åˆ›å»ºè„šæœ¬
**æ–‡ä»¶**: `create-test-data.js`
**åŠŸèƒ½**:
- åˆ›å»ºé»˜è®¤è§’è‰²(ç®¡ç†å‘˜ã€å‘˜å·¥ã€ç»ç†)
- åˆ›å»ºé»˜è®¤éƒ¨é—¨å’ŒèŒä½
- ç¡®ä¿test2ç”¨æˆ·æœ‰æ­£ç¡®çš„å‘˜å·¥è®°å½•å’Œè§’è‰²æƒé™
- åˆ›å»ºç¤ºä¾‹é¡¹ç›®ä¾›æµ‹è¯•ç”³è¯·(2ä¸ªactive, 1ä¸ªplanning, 1ä¸ªcompleted)
- åˆ›å»ºä¸šåŠ¡çº¿æ•°æ®

```bash
node scripts/create-test-data.js
```

### 3. APIæµ‹è¯•è„šæœ¬
**æ–‡ä»¶**: `test-available-api.js`
**åŠŸèƒ½**:
- æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•è·å–JWT token
- æµ‹è¯• `/api/projects/available` æ¥å£è°ƒç”¨
- éªŒè¯è¿”å›æ•°æ®æ ¼å¼å’Œå†…å®¹
- æµ‹è¯•APIæƒé™éªŒè¯æœºåˆ¶
- æ¨¡æ‹Ÿé¡¹ç›®ç”³è¯·æµç¨‹

```bash
# å®Œæ•´æµ‹è¯•
node scripts/test-available-api.js

# å¿«é€Ÿæµ‹è¯•(ä»…æµ‹è¯•æ ¸å¿ƒæ¥å£)
node scripts/test-available-api.js --quick
```

### 4. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬
**æ–‡ä»¶**: `data-consistency-check.js`
**åŠŸèƒ½**:
- éªŒè¯ç”¨æˆ·-å‘˜å·¥å…³è”å…³ç³»
- æ£€æŸ¥è§’è‰²-æƒé™é…ç½®
- ç¡®ä¿é¡¹ç›®æ•°æ®å®Œæ•´æ€§
- æ£€æŸ¥éƒ¨é—¨-èŒä½å±‚çº§å…³ç³»
- ç”Ÿæˆä¿®å¤å»ºè®®

```bash
node scripts/data-consistency-check.js
```

### 5. ä¸»æ‰§è¡Œè„šæœ¬
**æ–‡ä»¶**: `run-all-tests.js`
**åŠŸèƒ½**:
- ä¾æ¬¡è¿è¡Œæ‰€æœ‰æµ‹è¯•å’ŒéªŒè¯è„šæœ¬
- æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
- ç”Ÿæˆå®Œæ•´çš„æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š
- åˆ›å»ºå¿«é€Ÿæµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
node scripts/run-all-tests.js

# è¿è¡ŒæŒ‡å®šè„šæœ¬
node scripts/run-all-tests.js check-nedb-data.js
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡
ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `localhost:3002`:
```bash
cd backend
npm run dev
```

### å®Œæ•´æµ‹è¯•æµç¨‹
```bash
# 1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
node scripts/run-all-tests.js

# 2. æˆ–è€…ä¾æ¬¡æ‰‹åŠ¨è¿è¡Œ
node scripts/check-nedb-data.js
node scripts/data-consistency-check.js  
node scripts/create-test-data.js
node scripts/test-available-api.js
```

### å¿«é€Ÿæµ‹è¯•
```bash
# è¿è¡Œå¿«é€Ÿæµ‹è¯•è„šæœ¬(è‡ªåŠ¨ç”Ÿæˆ)
./scripts/quick-test.sh    # Linux/Mac
./scripts/quick-test.bat   # Windows
```

## ğŸ“Š æµ‹è¯•æ•°æ®æ¦‚è§ˆ

è¿è¡Œ `create-test-data.js` åä¼šåˆ›å»º:

### è§’è‰²æ•°æ®
- `role_admin`: ç³»ç»Ÿç®¡ç†å‘˜(æ‰€æœ‰æƒé™)
- `role_employee`: æ™®é€šå‘˜å·¥(åŸºæœ¬æƒé™)  
- `role_manager`: é¡¹ç›®ç»ç†(ç®¡ç†æƒé™)

### éƒ¨é—¨æ•°æ®
- `dept_tech`: æŠ€æœ¯éƒ¨
- `dept_product`: äº§å“éƒ¨
- `dept_operation`: è¿è¥éƒ¨

### èŒä½æ•°æ®
- `pos_dev`: å¼€å‘å·¥ç¨‹å¸ˆ(P3, 15K)
- `pos_senior_dev`: é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ(P4, 22K)
- `pos_pm`: äº§å“ç»ç†(P4, 20K)

### é¡¹ç›®æ•°æ®
- `proj_active_1`: ç§»åŠ¨ç«¯APPå¼€å‘é¡¹ç›®(active)
- `proj_planning_1`: æ•°æ®åˆ†æå¹³å°å»ºè®¾(planning)  
- `proj_active_2`: å¾®æœåŠ¡æ¶æ„å‡çº§(active)
- `proj_completed_1`: å®¢æˆ·ç®¡ç†ç³»ç»Ÿ(completed)

### test2ç”¨æˆ·é…ç½®
- ç”¨æˆ·å: `test2`
- å¯†ç : `123456`
- è§’è‰²: å‘˜å·¥ + ç»ç†
- å‘˜å·¥è®°å½•: é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆï¼ŒæŠ€æœ¯éƒ¨
- æƒé™: åŒ…å«é¡¹ç›®ç”³è¯·æƒé™

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   âœ— æ— æ³•è¿æ¥åˆ° users.db
   ```
   - æ£€æŸ¥ `database/` ç›®å½•æ˜¯å¦å­˜åœ¨
   - ç¡®ä¿æœ‰è¯»å†™æƒé™

2. **æœåŠ¡å™¨è¿æ¥å¤±è´¥**
   ```
   âŒ æœåŠ¡å™¨ä¸å¯è®¿é—®
   ```
   - ç¡®ä¿backendæœåŠ¡è¿è¡Œ: `cd backend && npm run dev`
   - æ£€æŸ¥ç«¯å£3002æ˜¯å¦è¢«å ç”¨

3. **test2ç”¨æˆ·ç™»å½•å¤±è´¥**
   ```
   âŒ ç™»å½•å¤±è´¥
   ```
   - è¿è¡Œ `create-test-data.js` åˆ›å»ºç”¨æˆ·
   - æ£€æŸ¥å¯†ç æ˜¯å¦ä¸º `123456`

4. **æƒé™ä¸è¶³**
   ```
   ğŸ”’ æƒé™ä¸è¶³
   ```
   - æ£€æŸ¥ç”¨æˆ·è§’è‰²é…ç½®
   - éªŒè¯è§’è‰²æƒé™è®¾ç½®

### è°ƒè¯•æ–¹æ³•

1. **é€æ­¥æ£€æŸ¥**
   ```bash
   # 1. æ£€æŸ¥æ•°æ®
   node scripts/check-nedb-data.js
   
   # 2. æ£€æŸ¥ä¸€è‡´æ€§  
   node scripts/data-consistency-check.js
   
   # 3. åˆ›å»ºæµ‹è¯•æ•°æ®
   node scripts/create-test-data.js
   
   # 4. æµ‹è¯•API
   node scripts/test-available-api.js
   ```

2. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
   - è„šæœ¬ä¼šè¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œä¿®å¤å»ºè®®
   - æŸ¥çœ‹consoleè¾“å‡ºä¸­çš„JSONæ•°æ®

## ğŸ“ˆ éªŒè¯ç»“æœ

### æˆåŠŸæŒ‡æ ‡
- âœ… æ‰€æœ‰è„šæœ¬æ‰§è¡ŒæˆåŠŸ(é€€å‡ºç 0)
- âœ… test2ç”¨æˆ·ç™»å½•æˆåŠŸ
- âœ… å¯ç”³è¯·é¡¹ç›®æ•°é‡ > 0  
- âœ… ç”¨æˆ·-å‘˜å·¥å…³è”å…³ç³»æ­£ç¡®
- âœ… APIæƒé™éªŒè¯é€šè¿‡

### é¢„æœŸè¾“å‡ºç¤ºä¾‹
```
ğŸ‰ APIæµ‹è¯•å®Œæˆï¼

ğŸ“‹ æµ‹è¯•ç»“æœæ€»ç»“:
  âœ“ æœåŠ¡å™¨è¿æ¥æ­£å¸¸
  âœ“ ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
  âœ“ Tokenè®¤è¯æœºåˆ¶å·¥ä½œæ­£å¸¸  
  âœ“ /api/projects/available æ¥å£å¯ç”¨
  âœ“ æƒé™éªŒè¯æœºåˆ¶æ­£å¸¸

ğŸ“Š ç»“æœ: æ‰¾åˆ° 3 ä¸ªå¯ç”³è¯·é¡¹ç›®
```

## ğŸ› ï¸ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ•°æ®åº“è·¯å¾„
åœ¨è„šæœ¬ä¸­ä¿®æ”¹ `dbPath`:
```javascript
this.dbPath = path.join(__dirname, '../../database');
```

### ä¿®æ”¹æœåŠ¡å™¨åœ°å€
åœ¨ `test-available-api.js` ä¸­ä¿®æ”¹:
```javascript
this.baseURL = 'http://localhost:3002';
```

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨æˆ·
åœ¨ `create-test-data.js` ä¸­æ·»åŠ ç”¨æˆ·åˆ›å»ºé€»è¾‘:
```javascript
const testUserData = {
    username: 'new_user',
    password: hashedPassword,
    roleIds: ['role_employee'],
    // ...
};
```

## ğŸ“ è„šæœ¬å¼€å‘æŒ‡å—

### æ·»åŠ æ–°è„šæœ¬
1. åœ¨ `scripts/` ç›®å½•åˆ›å»ºæ–°çš„ `.js` æ–‡ä»¶
2. å®ç°ä¸»ç±»å’Œ `run()` æ–¹æ³•
3. æ·»åŠ åˆ° `run-all-tests.js` çš„ `scripts` æ•°ç»„
4. æ›´æ–°æ­¤READMEæ–‡æ¡£

### è„šæœ¬æ¨¡æ¿
```javascript
class NewTestScript {
    constructor() {
        this.dbPath = path.join(__dirname, '../../database');
    }

    async run() {
        console.log('ğŸš€ æ–°æµ‹è¯•è„šæœ¬å¯åŠ¨');
        // å®ç°æµ‹è¯•é€»è¾‘
        console.log('âœ… æµ‹è¯•å®Œæˆ');
    }
}

if (require.main === module) {
    const script = new NewTestScript();
    script.run().catch(console.error);
}

module.exports = NewTestScript;
```

## ğŸ”§ ç»´æŠ¤è¯´æ˜

- å®šæœŸè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- åœ¨æ·»åŠ æ–°åŠŸèƒ½åæ›´æ–°ç›¸åº”çš„æµ‹è¯•è„šæœ¬
- ä¿æŒæµ‹è¯•æ•°æ®çš„æœ€æ–°çŠ¶æ€
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æƒé™é…ç½®

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜è¯·æ£€æŸ¥:
1. è„šæœ¬æ‰§è¡Œæ—¥å¿—
2. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š  
3. APIæ¥å£å“åº”
4. æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€