# ğŸ­ å¥–é‡‘æ¨¡æ‹Ÿç³»ç»Ÿç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ **éƒ¨ç½²æ¦‚è¿°**

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨**ä¼˜åŒ–ç‰ˆæ··åˆæœåŠ¡å™¨æ–¹æ¡ˆ**éƒ¨ç½²å¥–é‡‘æ¨¡æ‹Ÿç³»ç»Ÿåˆ°ç”Ÿäº§ç¯å¢ƒã€‚

### ğŸ¯ **é€‚ç”¨åœºæ™¯**
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- âœ… ç”¨æˆ·é‡ â‰¤ 100äºº
- âœ… ä¸­å°å‹ä¼ä¸šä½¿ç”¨
- âœ… éœ€è¦ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§

### ğŸ—ï¸ **æ¶æ„ç‰¹ç‚¹**
- **å•è¿›ç¨‹æœåŠ¡**ï¼šå‰ç«¯é™æ€æ–‡ä»¶ + åç«¯API
- **PM2è¿›ç¨‹ç®¡ç†**ï¼šè‡ªåŠ¨é‡å¯ã€è´Ÿè½½å‡è¡¡ã€ç›‘æ§
- **ç«¯å£ç»Ÿä¸€**ï¼šæ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨3000ç«¯å£
- **è¿ç»´å‹å¥½**ï¼šè‡ªåŠ¨åŒ–è„šæœ¬ã€å¥åº·æ£€æŸ¥ã€å¤‡ä»½

## ğŸš€ **å¿«é€Ÿéƒ¨ç½²**

### **æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰**

#### Windowsç”¨æˆ·
```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
scripts\prod-start.bat

# 2. æˆ–ç›´æ¥åŒå‡»è¿è¡Œ
scripts\prod-start.bat
```

#### Linux/Macç”¨æˆ·
```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/prod-start.sh

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
./scripts/prod-start.sh
```

### **æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²**

```bash
# 1. å®‰è£…PM2
npm install -g pm2

# 2. å®‰è£…é¡¹ç›®ä¾èµ–
cd frontend && npm install && cd ..
cd backend && npm install && cd ..

# 3. æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# 4. å¯åŠ¨ç”Ÿäº§æœåŠ¡
pm2 start ecosystem.config.js --env production

# 5. ä¿å­˜é…ç½®
pm2 save

# 6. è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

## ğŸ”§ **ç”Ÿäº§ç¯å¢ƒé…ç½®**

### **PM2é…ç½®æ–‡ä»¶ (ecosystem.config.js)**

```javascript
module.exports = {
  apps: [{
    name: 'bonus-system',
    script: 'simple-server.js',
    instances: 2,                    // å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
    exec_mode: 'cluster',            // é›†ç¾¤æ¨¡å¼
    max_memory_restart: '500M',      // å†…å­˜è¶…é™è‡ªåŠ¨é‡å¯
    restart_delay: 4000,             // é‡å¯å»¶è¿Ÿ
    max_restarts: 10,                // æœ€å¤§é‡å¯æ¬¡æ•°
    min_uptime: '10s',              // æœ€å°è¿è¡Œæ—¶é—´
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
}
```

### **ç¯å¢ƒå˜é‡é…ç½® (.env)**

```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆå¦‚ä½¿ç”¨MySQLï¼‰
DB_HOST=localhost
DB_PORT=3306
DB_NAME=bonus_system
DB_USER=root
DB_PASSWORD=your_secure_password

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your-super-secure-jwt-secret-key-here
JWT_REFRESH_SECRET=your-super-secure-refresh-secret-key-here

# æ–‡ä»¶ä¸Šä¼ é™åˆ¶
MAX_FILE_SIZE=10MB

# ç³»ç»Ÿé…ç½®
SYSTEM_NAME=å¥–é‡‘æ¨¡æ‹Ÿç³»ç»Ÿ
SYSTEM_VERSION=1.0.0
```

## ğŸ“Š **è¿ç»´ç®¡ç†**

### **æ—¥å¸¸ç®¡ç†å‘½ä»¤**

#### **ä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
# Linux/Mac
./scripts/prod-manage.sh [å‘½ä»¤]

# Windows
scripts\prod-manage.bat [å‘½ä»¤]
```

#### **ç›´æ¥ä½¿ç”¨PM2å‘½ä»¤**

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs bonus-system

# é‡å¯æœåŠ¡
pm2 restart bonus-system

# åœæ­¢æœåŠ¡
pm2 stop bonus-system

# å¯åŠ¨æœåŠ¡
pm2 start bonus-system

# åˆ é™¤æœåŠ¡
pm2 delete bonus-system
```

### **ç®¡ç†è„šæœ¬åŠŸèƒ½**

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `start` | å¯åŠ¨æœåŠ¡ | å¯åŠ¨æˆ–é‡å¯ç”Ÿäº§æœåŠ¡ |
| `stop` | åœæ­¢æœåŠ¡ | åœæ­¢ç”Ÿäº§æœåŠ¡ |
| `restart` | é‡å¯æœåŠ¡ | é‡å¯ç”Ÿäº§æœåŠ¡ |
| `status` | æŸ¥çœ‹çŠ¶æ€ | æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œèµ„æºä½¿ç”¨ |
| `logs` | æŸ¥çœ‹æ—¥å¿— | æ˜¾ç¤ºæœåŠ¡è¿è¡Œæ—¥å¿— |
| `monitor` | ç›‘æ§é¢æ¿ | å¯åŠ¨PM2 Webç›‘æ§ç•Œé¢ |
| `update` | æ›´æ–°åº”ç”¨ | æ‹‰å–ä»£ç ã€é‡æ–°æ„å»ºã€é‡å¯æœåŠ¡ |
| `backup` | å¤‡ä»½æ•°æ® | å¤‡ä»½æ•°æ®åº“ã€æ—¥å¿—ã€æ„å»ºæ–‡ä»¶ |
| `health` | å¥åº·æ£€æŸ¥ | æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€ç«¯å£ã€APIå“åº” |

## ğŸ” **ç›‘æ§å’Œæ—¥å¿—**

### **PM2ç›‘æ§é¢æ¿**

```bash
# å¯åŠ¨ç›‘æ§é¢æ¿
pm2 web

# è®¿é—®åœ°å€
http://localhost:9615
```

### **æ—¥å¿—ç®¡ç†**

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs bonus-system

# æŸ¥çœ‹å†å²æ—¥å¿—
pm2 logs bonus-system --lines 1000

# æ¸…ç©ºæ—¥å¿—
pm2 flush

# æ—¥å¿—è½®è½¬é…ç½®
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
```

### **å¥åº·æ£€æŸ¥**

```bash
# æ‰‹åŠ¨å¥åº·æ£€æŸ¥
./scripts/prod-manage.sh health

# å¥åº·æ£€æŸ¥å†…å®¹
âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
âœ… ç«¯å£ç›‘å¬æ£€æŸ¥
âœ… APIå“åº”æ£€æŸ¥
âœ… ç£ç›˜ç©ºé—´æ£€æŸ¥
âœ… å†…å­˜ä½¿ç”¨æ£€æŸ¥
```

## ğŸ›¡ï¸ **å®‰å…¨é…ç½®**

### **ç”Ÿäº§ç¯å¢ƒå®‰å…¨æªæ–½**

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - ç™»å½•ç³»ç»Ÿåç«‹å³ä¿®æ”¹adminå¯†ç 
   - ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥

2. **JWTå¯†é’¥å®‰å…¨**
   - ä¿®æ”¹é»˜è®¤JWTå¯†é’¥
   - ä½¿ç”¨è¶³å¤Ÿé•¿åº¦çš„éšæœºå¯†é’¥

3. **ç½‘ç»œè®¿é—®æ§åˆ¶**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - é™åˆ¶è®¿é—®IPèŒƒå›´

4. **HTTPSé…ç½®**
   - é…ç½®SSLè¯ä¹¦
   - å¼ºåˆ¶HTTPSè®¿é—®

### **é˜²ç«å¢™é…ç½®ç¤ºä¾‹**

```bash
# Ubuntu/Debian
sudo ufw allow 3000/tcp
sudo ufw allow 22/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=22/tcp
sudo firewall-cmd --reload
```

## ğŸ“ˆ **æ€§èƒ½ä¼˜åŒ–**

### **PM2æ€§èƒ½é…ç½®**

```javascript
// ä¼˜åŒ–åçš„ecosystem.config.js
module.exports = {
  apps: [{
    name: 'bonus-system',
    script: 'simple-server.js',
    instances: 'max',                 // ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
    exec_mode: 'cluster',             // é›†ç¾¤æ¨¡å¼
    max_memory_restart: '1G',         // å†…å­˜é™åˆ¶
    node_args: '--max-old-space-size=1024', // Node.jså†…å­˜é™åˆ¶
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
}
```

### **ç³»ç»Ÿä¼˜åŒ–å»ºè®®**

1. **å¢åŠ ç³»ç»Ÿé™åˆ¶**
   ```bash
   # å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
   ulimit -n 65536
   
   # å¢åŠ è¿›ç¨‹é™åˆ¶
   ulimit -u 4096
   ```

2. **æ•°æ®åº“ä¼˜åŒ–**
   - é…ç½®é€‚å½“çš„è¿æ¥æ± å¤§å°
   - ä¼˜åŒ–æŸ¥è¯¢è¯­å¥
   - æ·»åŠ å¿…è¦çš„ç´¢å¼•

3. **ç¼“å­˜ç­–ç•¥**
   - å¯ç”¨Redisç¼“å­˜ï¼ˆå¯é€‰ï¼‰
   - é…ç½®é™æ€èµ„æºç¼“å­˜
   - å®ç°APIå“åº”ç¼“å­˜

## ğŸ”„ **æ›´æ–°å’Œéƒ¨ç½²**

### **åº”ç”¨æ›´æ–°æµç¨‹**

```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
./scripts/prod-manage.sh backup

# 2. æ›´æ–°åº”ç”¨ä»£ç 
./scripts/prod-manage.sh update

# 3. éªŒè¯æ›´æ–°ç»“æœ
./scripts/prod-manage.sh health
```

### **å›æ»šç­–ç•¥**

```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
pm2 stop bonus-system

# 2. æ¢å¤å¤‡ä»½ç‰ˆæœ¬
cp -r frontend/dist.backup.[æ—¶é—´æˆ³] frontend/dist

# 3. é‡å¯æœåŠ¡
pm2 start bonus-system
```

## ğŸ“‹ **éƒ¨ç½²æ£€æŸ¥æ¸…å•**

### **éƒ¨ç½²å‰æ£€æŸ¥**

- [ ] Node.jsç‰ˆæœ¬ â‰¥ 16.0.0
- [ ] PM2å·²å®‰è£…
- [ ] ç«¯å£3000æœªè¢«å ç”¨
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“é…ç½®æ­£ç¡®
- [ ] å‰ç«¯æ„å»ºæˆåŠŸ

### **éƒ¨ç½²åéªŒè¯**

- [ ] æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] ç«¯å£3000æ­£å¸¸ç›‘å¬
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸è®¿é—®
- [ ] APIæ¥å£æ­£å¸¸å“åº”
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

### **ç”Ÿäº§ç¯å¢ƒéªŒè¯**

- [ ] ç³»ç»ŸåŠŸèƒ½å®Œæ•´æµ‹è¯•
- [ ] æ€§èƒ½å‹åŠ›æµ‹è¯•
- [ ] å®‰å…¨æ¼æ´æ‰«æ
- [ ] å¤‡ä»½åŠŸèƒ½éªŒè¯
- [ ] ç›‘æ§å‘Šè­¦é…ç½®
- [ ] è¿ç»´æ–‡æ¡£å®Œå–„

## ğŸš¨ **æ•…éšœæ’é™¤**

### **å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

#### **1. æœåŠ¡å¯åŠ¨å¤±è´¥**

```bash
# æ£€æŸ¥é”™è¯¯æ—¥å¿—
pm2 logs bonus-system --err

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :3000

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la simple-server.js
```

#### **2. å†…å­˜ä¸è¶³**

```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
pm2 monit

# è°ƒæ•´å†…å­˜é™åˆ¶
pm2 restart bonus-system --max-memory-restart 2G
```

#### **3. ç«¯å£å†²çª**

```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :3000

# åœæ­¢å†²çªè¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨Windows
netstat -ano | findstr :3000
taskkill /F /PID <PID>
```

#### **4. å‰ç«¯é¡µé¢æ— æ³•è®¿é—®**

```bash
# æ£€æŸ¥å‰ç«¯æ„å»º
ls -la frontend/dist

# é‡æ–°æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# é‡å¯æœåŠ¡
pm2 restart bonus-system
```

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

### **è·å–å¸®åŠ©**

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`pm2 logs bonus-system`
2. **å¥åº·æ£€æŸ¥**ï¼š`./scripts/prod-manage.sh health`
3. **ç³»ç»ŸçŠ¶æ€**ï¼š`./scripts/prod-manage.sh status`
4. **ç›‘æ§é¢æ¿**ï¼š`./scripts/prod-manage.sh monitor`

### **è”ç³»ä¿¡æ¯**

- **é¡¹ç›®ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ
- **æŠ€æœ¯æ”¯æŒ**: support@company.com
- **é—®é¢˜åé¦ˆ**: https://github.com/company/bonus-system/issues

---

## ğŸ¯ **éƒ¨ç½²æˆåŠŸæ ‡å¿—**

âœ… **æœåŠ¡çŠ¶æ€**: PM2æ˜¾ç¤ºæœåŠ¡ä¸º `online` çŠ¶æ€  
âœ… **ç«¯å£ç›‘å¬**: 3000ç«¯å£æ­£å¸¸ç›‘å¬  
âœ… **é¡µé¢è®¿é—®**: http://localhost:3000 æ­£å¸¸æ˜¾ç¤º  
âœ… **APIå“åº”**: `/api/health` æ¥å£æ­£å¸¸å“åº”  
âœ… **åŠŸèƒ½æµ‹è¯•**: ç™»å½•ã€å‘˜å·¥ç®¡ç†ç­‰åŠŸèƒ½æ­£å¸¸  
âœ… **æ€§èƒ½æŒ‡æ ‡**: å“åº”æ—¶é—´ < 2ç§’ï¼Œå†…å­˜ä½¿ç”¨ < 1GB  

**æ­å–œï¼ä½ çš„å¥–é‡‘æ¨¡æ‹Ÿç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼** ğŸ‰
